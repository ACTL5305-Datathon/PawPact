---
title: "Datathon Exploratory Analysis - ACTL5305"
author: "Viswesh Narayan"
date: "2024-09-23"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(readr)
library(tidyverse)
library(readxl)

```

# Earned Data

```{r}
claims_data <- read_csv('../data/internal/UNSW_claims_data.csv', col_names = TRUE)

earned_data <- read_csv('../data/internal/UNSW_earned_data_adjusted_Sep27.csv', col_names = TRUE)

```

# Earned Data Procedures

```{r}

earned_data$pet_age_group <- cut(earned_data$pet_age_months, 
                                 breaks = c(0, 12, 36, 72, 120, Inf), 
                                 labels = c("Puppy/Kitten", "Young", "Adult", "Senior", "Very Senior"))

```

```{r}

earned_data$owner_age_group <- cut(earned_data$owner_age_years, 
                                   breaks = c(0, 25, 40, 60, Inf), 
                                   labels = c("Young", "Middle-Aged", "Senior", "Elderly"))

```

```{r}

earned_data$breed_risk_category <- ifelse(grepl("retriever|bulldog", earned_data$nb_breed_name_unique, ignore.case = TRUE), 
                                          "High Risk", "Low/Moderate Risk")

earned_data$multi_pet_indicator <- as.integer(earned_data$is_multi_pet_plan)


```

```{r}

suburb_claim_frequency <- earned_data %>% 
                           group_by(nb_suburb) %>% 
                           summarise(claim_count = n())

```

# Claims Data Procedures

```{r}
claims_data$claim_severity <- claims_data$claim_paid / claims_data$total_claim_amount

claims_data$claim_paid_group <- cut(claims_data$claim_paid, 
                                    breaks = c(0.00000, 100, 500, 1000, Inf), 
                                    labels = c("Low", "Moderate", "High", "Very High"))


```

```{r}

condition_frequency <- claims_data %>% 
                       group_by(condition_category) %>% 
                       summarise(claim_count = n())


```

# ABS-SA Dataset

```{r}
ABS_ECI_T1 <- read_excel('../data/external/ABS_SA_Data/ECONOMYANDINDUSTRY.xlsx', sheet = "Table 1")

ABS_ECI_T2 <- read_excel('../data/external/ABS_SA_Data/ECONOMYANDINDUSTRY.xlsx', sheet = "Table 2")
```

```{r}
ABS_EDUEMP_T1 <- read_excel('../data/external/ABS_SA_Data/EDUCATIONANDEMPLOYMENT_SA2-4.xlsx', sheet = "Table 1")

ABS_EDUEMP_T2 <- read_excel('../data/external/ABS_SA_Data/EDUCATIONANDEMPLOYMENT_SA2-4.xlsx', sheet = "Table 2")
```

```{r}
ABS_FC_T1 <- read_excel('../data/external/ABS_SA_Data/FAMILYANDCOMMUNITY_SA2-4.xlsx', sheet = "Table 1")

ABS_FC_T2 <- read_excel('../data/external/ABS_SA_Data/FAMILYANDCOMMUNITY_SA2-4.xlsx', sheet = "Table 2")
```

```{r}
ABS_IN_T1 <- read_excel('../data/external/ABS_SA_Data/INCOME_SA2-4.xlsx', sheet = "Table 1")

ABS_IN_T2 <- read_excel('../data/external/ABS_SA_Data/INCOME_SA2-4.xlsx', sheet = "Table 2")
```


```{r}

# Convert dates to proper date format
claims_data$claim_start_date <- as.Date(claims_data$claim_start_date, format = "%Y-%m-%d")
earned_data$nb_policy_first_inception_date <- as.Date(earned_data$nb_policy_first_inception_date, format = "%Y-%m-%d")

# Check for missing values and handle them
claims_data <- na.omit(claims_data)
earned_data <- na.omit(earned_data)

```


```{r}

# Create Season Variable: Extract month from claim start date
claims_data$season <- month(claims_data$claim_start_date)

# Categorize into seasons
claims_data$season_category <- cut(claims_data$season, 
                                   breaks = c(0, 3, 6, 9, 12), 
                                   labels = c("Summer", "Autumn", "Winter", "Spring"))

```


```{r}

# Count the number of claims per owner (account_id)
claim_frequency_per_owner <- claims_data %>%
  group_by(claim_id) %>%
  summarise(claim_count = n())

# Merge back into the earned_data
#earned_data <- earned_data %>%
#  left_join(claim_frequency_per_owner, by = "claim_id")

# Replace NA values with 0 for owners with no claims
earned_data$claim_count[is.na(earned_data$claim_count)] <- 0

```


```{r}
ggplot(data = claims_data) +
  geom_point(mapping = aes(x = condition_category, y = claim_paid))

ggplot(data = claims_data) +
  geom_point(mapping = aes(x = condition_category, y = total_claim_amount))
```


```{r}
#For boxplot YearIncurred must be a factor
#claims_data$tenure = as.factor(claims_data$tenure)
ggplot(data = claims_data) +
  geom_boxplot(mapping = aes(x = tenure, y = claim_paid))

claims2_data = group_by(claims_data, tenure) %>% summarise(claims_data = mean(claim_paid))
ggplot(data = claims2_data) +
  geom_point(mapping = aes(y = claims_data, x = tenure))


```
